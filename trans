# STEP 0: Install & Import
!pip install seaborn scikit-learn --quiet
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression
from sklearn.metrics import mean_absolute_error, r2_score
# STEP 1: Mount Google Drive
from google.colab import drive
drive.mount('/content/drive')
# STEP 2: Set folder path
folder_path = '/content/drive/MyDrive/dataminig pro/'  # <-- Make sure trailing '/'
# STEP 3: Load CSVs
customer = pd.read_csv(folder_path + "Customer.csv")
membership = pd.read_csv(folder_path + "Membership.csv")
shipment = pd.read_csv(folder_path + "Shipment_Details.csv")
employee = pd.read_csv(folder_path + "Employee_Details.csv")
manage = pd.read_csv(folder_path + "employee_manages_shipment.csv")
payment = pd.read_csv(folder_path + "Payment_Details.csv")
status = pd.read_csv(folder_path + "Status.csv")
print(" Files loaded successfully!")
# STEP 4: Rename columns for merging
customer.rename(columns={'C_ID':'CustomerID', 'M_ID':'MembershipID', 'C_NAME':'CustomerName'}, inplace=True)
membership.rename(columns={'M_ID':'MembershipID'}, inplace=True)
shipment.rename(columns={'SH_ID':'ShipmentID', 'C_ID':'CustomerID', 'SH_WEIGHT':'WeightKg', 'SH_CHARGES':'ShipmentAmount'}, inplace=True)
employee.rename(columns={'E_ID':'EmployeeID', 'E_NAME':'EmployeeName'}, inplace=True)
payment.rename(columns={'Payment_ID':'PaymentID', 'C_ID':'CustomerID', 'SH_ID':'ShipmentID', 'AMOUNT':'PaymentAmount'}, inplace=True)
status.rename(columns={'SH_ID':'ShipmentID', 'Current_Status':'StatusName'}, inplace=True)
manage.rename(columns={'Employee_E_ID':'EmployeeID', 'Shipment_Sh_ID':'ShipmentID'}, inplace=True)
# STEP 5: Merge shipments → employees via manage
shipment_emp = shipment.merge(manage, on='ShipmentID', how='left')
shipment_emp = shipment_emp.merge(employee, on='EmployeeID', how='left')
# STEP 6: Merge with customer, payment, status, membership
df = (shipment_emp
      .merge(customer, on='CustomerID', how='left')
      .merge(payment, on=['CustomerID','ShipmentID'], how='left')
      .merge(status, on='ShipmentID', how='left')
      .merge(membership, on='MembershipID', how='left'))
# STEP 7: Fix duplicate numeric columns
# Combine shipment and payment amounts into one column for analysis
if 'ShipmentAmount' in df.columns and 'PaymentAmount' in df.columns:
    df['Amount'] = df['ShipmentAmount'].fillna(0) + df['PaymentAmount'].fillna(0)
elif 'ShipmentAmount' in df.columns:
    df['Amount'] = df['ShipmentAmount']
elif 'PaymentAmount' in df.columns:
    df['Amount'] = df['PaymentAmount']
# Check columns
print("\n Merged dataframe columns:\n", df.columns.tolist())
print("\nRows:", len(df))
df.head()
# STEP 8: Basic Stats
numeric_cols = ['WeightKg', 'Amount']
print("\n=== BASIC SUMMARY ===")
print(df[numeric_cols].describe())
# STEP 9: Visualizations
# Revenue by Customer Type
if 'C_TYPE' in df.columns:
    plt.figure(figsize=(8,5))
    sns.barplot(data=df, x='C_TYPE', y='Amount', estimator=sum, ci=None)
    plt.title("Total Revenue by Customer Type")
    plt.xticks(rotation=30)
    plt.show()
# Revenue by Employee
plt.figure(figsize=(10,5))
sns.barplot(data=df, x='EmployeeName', y='Amount', estimator=sum, ci=None)
plt.title("Revenue Handled by Employee")
plt.xticks(rotation=45, ha='right')
plt.show()
# Shipments by Status
plt.figure(figsize=(6,4))
sns.countplot(data=df, x='StatusName', order=df['StatusName'].value_counts().index)
plt.title("Shipments by Status")
plt.xticks(rotation=30)
plt.show()
# STEP 10: Predictive model - Weight vs Amount
df_model = df[['WeightKg','Amount']].dropna()
X = df_model[['WeightKg']]
y = df_model['Amount']
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)
model = LinearRegression()
model.fit(X_train, y_train)
y_pred = model.predict(X_test)
mae = mean_absolute_error(y_test, y_pred)
r2 = r2_score(y_test, y_pred)
print("\n=== MODEL ACCURACY (Weight → Amount) ===")
print(f"Mean Absolute Error: {mae:.2f}")
print(f"R² Score: {r2:.2f}")
plt.figure(figsize=(6,6))
sns.scatterplot(x=y_test, y=y_pred, alpha=0.6)
plt.xlabel("Actual Amount")
plt.ylabel("Predicted Amount")
plt.title("Model Accuracy: Actual vs Predicted Amount")
plt.show()
# STEP 11: Save merged data
df.to_csv(folder_path + "Logistics_Analytics_Merged.csv", index=False)
print(f"\n Merged dataset saved as {folder_path}Logistics_Analytics_Merged.csv")
